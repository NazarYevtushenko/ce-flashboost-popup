<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OlyBet SuperBoost Executive Editor</title>
    <style>
        :root { --primary: #e32d37; --bg: #f4f7f6; --dark: #1e1e1e; --accent: #00ff7f; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; color: #333; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 400px; background: white; padding: 25px; box-shadow: 2px 0 15px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .sidebar-content { flex-grow: 1; overflow-y: auto; padding-right: 10px; }
        h2 { margin-top: 0; font-size: 20px; color: var(--primary); border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        
        .import-box { background: #fdf2f2; border: 1px solid #fee2e2; border-radius: 8px; padding: 12px; margin-bottom: 20px; }
        .import-box label { color: var(--primary); font-weight: 800; }
        
        .group { margin-bottom: 12px; }
        label { display: block; font-size: 11px; font-weight: 700; color: #888; text-transform: uppercase; margin-bottom: 4px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 13px; outline: none; }
        select { background: #fff4f4; border-color: var(--primary); font-weight: bold; cursor: pointer; }
        textarea#intro { height: 60px; resize: vertical; }

        /* Workspace */
        .workspace { flex-grow: 1; padding: 40px; display: flex; flex-direction: column; gap: 20px; overflow-y: auto; align-items: center; }
        .preview-box { background: #333; border-radius: 12px; padding: 40px; display: flex; justify-content: center; align-items: center; width: 100%; max-width: 800px; min-height: 400px; box-shadow: inset 0 0 50px rgba(0,0,0,0.2); }
        .code-box { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); width: 100%; max-width: 800px; }
        textarea#output { height: 100px; font-family: 'Courier New', monospace; font-size: 11px; background: #fafafa; }
        
        .copy-btn { background: var(--dark); color: white; border: none; padding: 15px; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; width: 100%; margin-top: 10px; }
        .copy-btn:hover { background: #000; box-shadow: 0 4px 12px rgba(0,255,127,0.2); }
        .import-btn { background: var(--dark); color: white; border: none; padding: 8px; border-radius: 4px; font-size: 11px; cursor: pointer; margin-top: 5px; width: 100%; }

        .team-mention { margin-top: 20px; padding: 15px; background: #fff5f5; border-radius: 10px; border: 1px dashed var(--primary); font-size: 12px; text-align: center; }
        .heart { color: var(--primary); animation: beat .3s infinite alternate; display: inline-block; }
        @keyframes beat { to { transform: scale(1.1); } }
        .hint { font-size: 10px; color: #999; margin-top: 2px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-content">
        <h2>SuperBoost Editor üöÄ</h2>
        
        <div class="import-box">
            <label>IMPORT OLD CODE</label>
            <textarea id="import-html" style="height: 50px; margin-top: 5px;" placeholder="Paste code here..."></textarea>
            <button class="import-btn" onclick="importHTML()">PARSE CODE ‚Üë</button>
        </div>

        <div class="group">
            <label>1. Language Template</label>
            <select id="lang" onchange="generate()">
                <option value="EN">English (EN)</option>
                <option value="ET">Estonian (ET)</option>
                <option value="RU">Russian (RU)</option>
                <option value="LV">Latvian (LV)</option>
            </select>
        </div>

        <div class="group"><label>Image URL</label><input id="img" type="text" oninput="generate()"></div>
        <div class="group">
            <label>Intro Text (Ctrl+B = Bold)</label>
            <textarea id="intro" oninput="generate()"></textarea>
            <div class="hint">Use <b>Ctrl+B</b> to make selected text bold</div>
        </div>
        <div class="group"><label>Line Text</label><input id="line" type="text" oninput="generate()"></div>
        <div class="group"><label>Old Odds</label><input id="old" type="text" oninput="generate()"></div>
        <div class="group"><label>New Odds</label><input id="new" type="text" oninput="generate()"></div>
        <div class="group"><label>Button Link</label><input id="link" type="text" oninput="generate()"></div>

        <button class="copy-btn" onclick="copyCode()">COPY HTML CODE</button>

        <div class="team-mention">
            Made with <span class="heart">‚ù§Ô∏è</span> for <br>
            <b>OlyBet Executive Team</b><br>
            <small>(–í–µ—Ä–æ–Ω–∏–∫–∞, –ú–∞—à–∞, –õ–µ—Ä–∞, –ê–Ω–≥–µ–ª–∏–Ω–∞, –ö–∏—Ç–∏—è)</small>
        </div>
    </div>
</div>

<div class="workspace">
    <div class="preview-box" id="preview"></div>
    <div class="code-box">
        <label>Generated Source</label>
        <textarea id="output" readonly></textarea>
    </div>
</div>

<script>
const templates = {
    EN: `<div style="text-align:left;display:inline-block;font-family:Montserrat,sans-serif;background-color:#252525;border-radius:10px;max-width:400px;box-shadow:0 4px 15px rgba(0,0,0,.5);position:relative;font-size:14px;padding:0;overflow:hidden" class=popup><div style=background-color:#252525;text-align:center><img alt="Boost" src="[IMG LINK]" style=width:100%;height:auto;display:block><div style="padding:15px 10px"><h2 style="margin:0;color:#fff;font-size:22px;line-height:1.1;font-weight:900;text-transform:uppercase;text-shadow:1px 1px 2px rgba(0,0,0,.2)"> FLASH SUPERBOOST</h2></div></div><div style="padding:25px 20px;color:#fff;text-align:center"><p style="margin:0 0 20px 0;font-size:14px;line-height:1.5;color:#ccc">[INTRO TEXT]<br>[LINE]<div style="background-color:#252525;border:1px solid #333;border-radius:8px;padding:15px;margin-bottom:20px;display:flex;align-items:center;justify-content:center;gap:15px"><div style=text-align:center><div style=font-size:11px;color:#888;font-weight:700;margin-bottom:2px>WAS</div><div style=font-size:20px;color:#888;text-decoration:line-through;font-weight:600>[OLD ODDS]</div></div><div style=font-size:24px;color:#f73535>‚ûî</div><div style=text-align:center><div style=font-size:11px;color:#f73535;font-weight:700;margin-bottom:2px>NOW</div><div style=font-size:36px;color:#f73535;font-weight:900;line-height:1>[NEW ODDS]</div></div></div><p style="margin:0 0 20px 0;font-size:13px;line-height:1.4;color:#999">Max bet ‚Ç¨10. Find it in the OlyBoost section!<p style="margin:0 0 20px 0;font-size:14px;line-height:1.5;color:#ccc"><a href="[LINK]" style=text-decoration:none;display:block target=_blank><span style="display:block;width:100%;background-color:#00ff7f;color:#000;padding:14px 0;font-weight:800;font-size:18px;border-radius:4px;text-transform:uppercase;box-shadow:0 4px 0 #0c6">GO FOR IT</span></a></div></div><style>#modal-title{display:none!important}#modal-background{background:0 0!important;text-align:center}</style>`,
    ET: `<div style="text-align:left;display:inline-block;font-family:Montserrat,sans-serif;background-color:#252525;border-radius:10px;max-width:400px;box-shadow:0 4px 15px rgba(0,0,0,.5);position:relative;font-size:14px;padding:0;overflow:hidden" class=popup><div style=background-color:#252525;text-align:center><img alt="Boost" src="[IMG LINK]" style=width:100%;height:auto;display:block><div style="padding:15px 10px"><h2 style="margin:0;color:#fff;font-size:22px;line-height:1.1;font-weight:900;text-transform:uppercase;text-shadow:1px 1px 2px rgba(0,0,0,.2)"> FLASH SUPERBOOST</h2></div></div><div style="padding:25px 20px;color:#fff;text-align:center"><p style="margin:0 0 20px 0;font-size:14px;line-height:1.5;color:#ccc">[INTRO TEXT]<br>[LINE]<div style="background-color:#252525;border:1px solid #333;border-radius:8px;padding:15px;margin-bottom:20px;display:flex;align-items:center;justify-content:center;gap:15px"><div style=text-align:center><div style=font-size:11px;color:#888;font-weight:700;margin-bottom:2px>ENNE</div><div style=font-size:20px;color:#888;text-decoration:line-through;font-weight:600>[OLD ODDS]</div></div><div style=font-size:24px;color:#f73535>‚ûî</div><div style=text-align:center><div style=font-size:11px;color:#f73535;font-weight:700;margin-bottom:2px>N√ú√úD</div><div style=font-size:36px;color:#f73535;font-weight:900;line-height:1>[NEW ODDS]</div></div></div><p style="margin:0 0 20px 0;font-size:13px;line-height:1.4;color:#999">Maksimaalne panus 10 ‚Ç¨. Leia see OlyBoosti sektsioonist!<p style="margin:0 0 20px 0;font-size:14px;line-height:1.5;color:#ccc"><a href="[LINK]" style=text-decoration:none;display:block target=_blank><span style="display:block;width:100%;background-color:#00ff7f;color:#000;padding:14px 0;font-weight:800;font-size:18px;border-radius:4px;text-transform:uppercase;box-shadow:0 4px 0 #0c6">HAKKA PIHTA</span></a></div></div><style>#modal-title{display:none!important}#modal-background{background:0 0!important;text-align:center}</style>`,
    RU: `<div style="text-align:left;display:inline-block;font-family:Montserrat,sans-serif;background-color:#252525;border-radius:10px;max-width:400px;box-shadow:0 4px 15px rgba(0,0,0,.5);position:relative;font-size:14px;padding:0;overflow:hidden" class=popup><div style=background-color:#252525;text-align:center><img alt="Boost" src="[IMG LINK]" style=width:100%;height:auto;display:block><div style="padding:15px 10px"><h2 style="margin:0;color:#fff;font-size:22px;line-height:1.1;font-weight:900;text-transform:uppercase;text-shadow:1px 1px 2px rgba(0,0,0,.2)"> FLASH SUPERBOOST</h2></div></div><div style="padding:25px 20px;color:#fff;text-align:center"><p style="margin:0 0 20px 0;font-size:14px;line-height:1.5;color:#ccc">[INTRO TEXT]<br>[LINE]<div style="background-color:#252525;border:1px solid #333;border-radius:8px;padding:15px;margin-bottom:20px;display:flex;align-items:center;justify-content:center;gap:15px"><div style=text-align:center><div style=font-size:11px;color:#888;font-weight:700;margin-bottom:2px>–ë–´–õ</div><div style=font-size:20px;color:#888;text-decoration:line-through;font-weight:600>[OLD ODDS]</div></div><div style=font-size:24px;color:#f73535>‚ûî</div><div style=text-align:center><div style=font-size:11px;color:#f73535;font-weight:700;margin-bottom:2px>–¢–ï–ü–ï–†–¨</div><div style=font-size:36px;color:#f73535;font-weight:900;line-height:1>[NEW ODDS]</div></div></div><p style="margin:0 0 20px 0;font-size:13px;line-height:1.4;color:#999">–ú–∞–∫—Å. —Å—Ç–∞–≤–∫–∞ 10 ‚Ç¨. –ù–∞–π–¥–∏—Ç–µ –µ–≥–æ –≤ —Ä–∞–∑–¥–µ–ª–µ OlyBoost!<p style="margin:0 0 20px 0;font-size:14px;line-height:1.5;color:#ccc"><a href="[LINK]" style=text-decoration:none;display:block target=_blank><span style="display:block;width:100%;background-color:#00ff7f;color:#000;padding:14px 0;font-weight:800;font-size:18px;border-radius:4px;text-transform:uppercase;box-shadow:0 4px 0 #0c6">–í–ü–ï–†–Å–î</span></a></div></div><style>#modal-title{display:none!important}#modal-background{background:0 0!important;text-align:center}</style>`,
    LV: `<div style="text-align:left;display:inline-block;font-family:Montserrat,sans-serif;background-color:#252525;border-radius:10px;max-width:400px;box-shadow:0 4px 15px rgba(0,0,0,.5);position:relative;font-size:14px;padding:0;overflow:hidden" class=popup><div style=background-color:#252525;text-align:center><img alt="Boost" src="[IMG LINK]" style=width:100%;height:auto;display:block><div style="padding:15px 10px"><h2 style="margin:0;color:#fff;font-size:22px;line-height:1.1;font-weight:900;text-transform:uppercase;text-shadow:1px 1px 2px rgba(0,0,0,.2)"> FLASH SUPERBOOST</h2></div></div><div style="padding:25px 20px;color:#fff;text-align:center"><p style="margin:0 0 20px 0;font-size:14px;line-height:1.5;color:#ccc">[INTRO TEXT]<br>[LINE]<div style="background-color:#252525;border:1px solid #333;border-radius:8px;padding:15px;margin-bottom:20px;display:flex;align-items:center;justify-content:center;gap:15px"><div style=text-align:center><div style=font-size:11px;color:#888;font-weight:700;margin-bottom:2px>BIJA</div><div style=font-size:20px;color:#888;text-decoration:line-through;font-weight:600>[OLD ODDS]</div></div><div style=font-size:24px;color:#f73535>‚ûî</div><div style=text-align:center><div style=font-size:11px;color:#f73535;font-weight:700;margin-bottom:2px>TAGAD</div><div style=font-size:36px;color:#f73535;font-weight:900;line-height:1>[NEW ODDS]</div></div></div><p style="margin:0 0 20px 0;font-size:13px;line-height:1.4;color:#999">Maks. likme ‚Äì 10 ‚Ç¨. Atrodi piedƒÅvƒÅjumu OlyBoost sadaƒºƒÅ!<p style="margin:0 0 20px 0;font-size:14px;line-height:1.5;color:#ccc"><a href="[LINK]" style=text-decoration:none;display:block target=_blank><span style="display:block;width:100%;background-color:#00ff7f;color:#000;padding:14px 0;font-weight:800;font-size:18px;border-radius:4px;text-transform:uppercase;box-shadow:0 4px 0 #0c6">UZ PRIEK≈†U</span></a></div></div><style>#modal-title{display:none!important}#modal-background{background:0 0!important;text-align:center}</style>`
};

const fields = ['lang', 'img', 'intro', 'line', 'old', 'new', 'link'];
let historyStack = [];
let redoStack = [];
let isProcessing = false;

// --- UNDO / REDO LOGIC ---
function getCurrentState() {
    const state = {};
    fields.forEach(id => state[id] = document.getElementById(id).value);
    return JSON.stringify(state);
}

function saveState() {
    if (isProcessing) return;
    const currentState = getCurrentState();
    const lastState = historyStack.length > 0 ? JSON.stringify(historyStack[historyStack.length - 1]) : null;
    if (currentState !== lastState) {
        historyStack.push(JSON.parse(currentState));
        redoStack = [];
        if (historyStack.length > 50) historyStack.shift();
    }
}

function undo() {
    if (historyStack.length > 1) {
        redoStack.push(historyStack.pop());
        applyState(historyStack[historyStack.length - 1]);
    }
}

function redo() {
    if (redoStack.length > 0) {
        const state = redoStack.pop();
        historyStack.push(state);
        applyState(state);
    }
}

function applyState(state) {
    if (!state) return;
    isProcessing = true;
    fields.forEach(id => document.getElementById(id).value = state[id]);
    generate(true);
    isProcessing = false;
}

// --- IMPORT LOGIC ---
function importHTML() {
    const raw = document.getElementById('import-html').value;
    if (!raw) return alert("Paste code first!");
    const parser = new DOMParser();
    const doc = parser.parseFromString(raw, 'text/html');
    try {
        isProcessing = true;
        document.getElementById('img').value = doc.querySelector('img')?.getAttribute('src') || "";
        
        // Find WAS/NOW labels to detect language
        const wasLabel = doc.body.innerText;
        if (wasLabel.includes("–ë–´–õ")) document.getElementById('lang').value = "RU";
        else if (wasLabel.includes("ENNE")) document.getElementById('lang').value = "ET";
        else if (wasLabel.includes("BIJA")) document.getElementById('lang').value = "LV";
        else document.getElementById('lang').value = "EN";

        let introHtml = doc.querySelector('p[style*="font-size:14px"]')?.innerHTML || "";
        // Extract Intro Text (before <br>)
        document.getElementById('intro').value = introHtml.split('<br>')[0].replace(/<[^>]*>/g, '').trim();
        // Extract Line Text (after <br>)
        document.getElementById('line').value = introHtml.split('<br>')[1]?.replace(/<[^>]*>/g, '').trim() || "";
        
        // Odds - based on styles
        const odds = doc.querySelectorAll('div[style*="font-weight:600"], div[style*="font-weight:900"]');
        document.getElementById('old').value = odds[0]?.innerText || "";
        document.getElementById('new').value = odds[1]?.innerText || "";
        
        document.getElementById('link').value = doc.querySelector('a')?.getAttribute('href') || "";
        
        isProcessing = false;
        saveState();
        generate();
        alert("Import successful!");
    } catch (e) {
        isProcessing = false;
        alert("Parsing error. Check format.");
    }
}

// --- CORE GENERATION ---
function generate(skipHistory = false) {
    const lang = document.getElementById('lang').value;
    let html = templates[lang];

    const vals = {
        "[IMG LINK]": document.getElementById('img').value || 'https://via.placeholder.com/400x225/e32d37/FFFFFF?text=SuperBoost',
        "[INTRO TEXT]": document.getElementById('intro').value.replace(/\n/g, '<br>') || 'EVENT NAME',
        "[LINE]": document.getElementById('line').value || 'SUBTITLE LINE',
        "[OLD ODDS]": document.getElementById('old').value || '0.00',
        "[NEW ODDS]": document.getElementById('new').value || '0.00',
        "[LINK]": document.getElementById('link').value || '#'
    };

    for (const [key, value] of Object.entries(vals)) {
        html = html.replaceAll(key, value);
    }

    document.getElementById('output').value = html;
    document.getElementById('preview').innerHTML = html;

    if (!isProcessing && !skipHistory) {
        clearTimeout(window.saveTimeout);
        window.saveTimeout = setTimeout(saveState, 500);
    }
}

// --- HOTKEYS ---
window.addEventListener('keydown', function(e) {
    const isCmdOrCtrl = e.ctrlKey || e.metaKey;
    if (isCmdOrCtrl && e.code === 'KeyZ' && !e.shiftKey) {
        e.preventDefault();
        undo();
    }
    if (isCmdOrCtrl && (e.code === 'KeyY' || (e.code === 'KeyZ' && e.shiftKey))) {
        e.preventDefault();
        redo();
    }
    if (isCmdOrCtrl && e.code === 'KeyB' && document.activeElement.id === 'intro') {
        e.preventDefault();
        const el = document.getElementById('intro');
        const s = el.selectionStart, end = el.selectionEnd;
        const txt = el.value;
        el.value = txt.substring(0, s) + '<strong>' + txt.substring(s, end) + '</strong>' + txt.substring(end);
        el.focus();
        el.selectionStart = s + 8; el.selectionEnd = end + 8;
        saveState();
        generate();
    }
});

function copyCode() {
    const out = document.getElementById("output");
    out.select();
    document.execCommand("copy");
    alert("Copied!");
}

window.onload = () => {
    saveState();
    generate();
};
</script>
</body>
</html>